/************************************************************************
	fft.c

    FFT Audio Analysis
    Copyright (C) 2011 Simon Inns

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

	Email: simon.inns@gmail.com

************************************************************************/

#ifndef FFT_C
#define FFT_C

#include "fft.h"

// fix_fft.c -Fixed-point in-place Fast Fourier Transform

// All data are fixed-point short integers, in which -32768
// to +32768 represent -1.0 to +1.0 respectively. Integer
// arithmetic is used for speed, instead of the more natural
// floating-point.
//
// For the forward FFT (time -> freq), fixed scaling is
// performed to prevent arithmetic overflow, and to map a 0dB
// sine/cosine wave (i.e. amplitude = 32767) to two -6dB freq
// coefficients.
//
// Written by:  Tom Roberts  11/8/89
// Made portable:  Malcolm Slaney 12/15/94 malcolm@interval.com
// Enhanced:  Dimitrios P. Bouras  14 Jun 2006 dbouras@ieee.org
// Ported to PIC18F:  Simon Inns 20110104
// Enhanced: Beichen Chen and Amy Chen 4 Dec 2017

#define FIX_MPY(DEST,A,B)       DEST = ((long)(A) * (long)(B))>>15

#if N_WAVE != 1024
ERROR:N_WAVE != 1024
#endif
    short gst_spectrum_Sinewave[1024] = {
0, 201, 402, 603, 804, 1005, 1206, 1406,
      1607, 1808, 2009, 2209, 2410, 2610, 2811, 3011,
      3211, 3411, 3611, 3811, 4011, 4210, 4409, 4608,
      4807, 5006, 5205, 5403, 5601, 5799, 5997, 6195,
      6392, 6589, 6786, 6982, 7179, 7375, 7571, 7766,
      7961, 8156, 8351, 8545, 8739, 8932, 9126, 9319,
      9511, 9703, 9895, 10087, 10278, 10469, 10659, 10849,
      11038, 11227, 11416, 11604, 11792, 11980, 12166, 12353,
      12539, 12724, 12909, 13094, 13278, 13462, 13645, 13827,
      14009, 14191, 14372, 14552, 14732, 14911, 15090, 15268,
      15446, 15623, 15799, 15975, 16150, 16325, 16499, 16672,
      16845, 17017, 17189, 17360, 17530, 17699, 17868, 18036,
      18204, 18371, 18537, 18702, 18867, 19031, 19194, 19357,
      19519, 19680, 19840, 20000, 20159, 20317, 20474, 20631,
      20787, 20942, 21096, 21249, 21402, 21554, 21705, 21855,
      22004, 22153, 22301, 22448, 22594, 22739, 22883, 23027,
      23169, 23311, 23452, 23592, 23731, 23869, 24006, 24143,
      24278, 24413, 24546, 24679, 24811, 24942, 25072, 25201,
      25329, 25456, 25582, 25707, 25831, 25954, 26077, 26198,
      26318, 26437, 26556, 26673, 26789, 26905, 27019, 27132,
      27244, 27355, 27466, 27575, 27683, 27790, 27896, 28001,
      28105, 28208, 28309, 28410, 28510, 28608, 28706, 28802,
      28897, 28992, 29085, 29177, 29268, 29358, 29446, 29534,
      29621, 29706, 29790, 29873, 29955, 30036, 30116, 30195,
      30272, 30349, 30424, 30498, 30571, 30643, 30713, 30783,
      30851, 30918, 30984, 31049,
      31113, 31175, 31236, 31297,
      31356, 31413, 31470, 31525, 31580, 31633, 31684, 31735,
      31785, 31833, 31880, 31926, 31970, 32014, 32056, 32097,
      32137, 32176, 32213, 32249, 32284, 32318, 32350, 32382,
      32412, 32441, 32468, 32495, 32520, 32544, 32567, 32588,
      32609, 32628, 32646, 32662, 32678, 32692, 32705, 32717,
      32727, 32736, 32744, 32751, 32757, 32761, 32764, 32766,
      32767, 32766, 32764, 32761, 32757, 32751, 32744, 32736,
      32727, 32717, 32705, 32692, 32678, 32662, 32646, 32628,
      32609, 32588, 32567, 32544, 32520, 32495, 32468, 32441,
      32412, 32382, 32350, 32318, 32284, 32249, 32213, 32176,
      32137, 32097, 32056, 32014, 31970, 31926, 31880, 31833,
      31785, 31735, 31684, 31633, 31580, 31525, 31470, 31413,
      31356, 31297, 31236, 31175, 31113, 31049, 30984, 30918,
      30851, 30783, 30713, 30643, 30571, 30498, 30424, 30349,
      30272, 30195, 30116, 30036, 29955, 29873, 29790, 29706,
      29621, 29534, 29446, 29358, 29268, 29177, 29085, 28992,
      28897, 28802, 28706, 28608, 28510, 28410, 28309, 28208,
      28105, 28001, 27896, 27790, 27683, 27575, 27466, 27355,
      27244, 27132, 27019, 26905, 26789, 26673, 26556, 26437,
      26318, 26198, 26077, 25954, 25831, 25707, 25582, 25456,
      25329, 25201, 25072, 24942, 24811, 24679, 24546, 24413,
      24278, 24143, 24006, 23869, 23731, 23592, 23452, 23311,
      23169, 23027, 22883, 22739, 22594, 22448, 22301, 22153,
      22004, 21855, 21705, 21554, 21402, 21249, 21096, 20942,
      20787, 20631, 20474, 20317, 20159, 20000, 19840, 19680,
      19519, 19357, 19194, 19031, 18867, 18702, 18537, 18371,
      18204, 18036, 17868, 17699, 17530, 17360, 17189, 17017,
      16845, 16672, 16499, 16325, 16150, 15975, 15799, 15623,
      15446, 15268, 15090, 14911, 14732, 14552, 14372, 14191,
      14009, 13827, 13645, 13462, 13278, 13094, 12909, 12724,
      12539, 12353, 12166, 11980, 11792, 11604, 11416, 11227,
      11038, 10849, 10659, 10469, 10278, 10087, 9895, 9703,
      9511, 9319, 9126, 8932, 8739, 8545, 8351, 8156,
      7961, 7766, 7571, 7375, 7179, 6982, 6786, 6589,
      6392, 6195, 5997, 5799, 5601, 5403, 5205, 5006,
      4807, 4608, 4409, 4210, 4011, 3811, 3611, 3411,
      3211, 3011, 2811, 2610, 2410, 2209, 2009, 1808,
      1607, 1406, 1206, 1005, 804, 603, 402, 201,
      0, -201, -402, -603, -804, -1005, -1206, -1406,
      -1607, -1808, -2009, -2209, -2410, -2610, -2811, -3011,
      -3211, -3411, -3611, -3811, -4011, -4210, -4409, -4608,
      -4807, -5006, -5205, -5403, -5601, -5799, -5997, -6195,
      -6392, -6589, -6786, -6982, -7179, -7375, -7571, -7766,
      -7961, -8156, -8351, -8545, -8739, -8932, -9126, -9319,
      -9511, -9703, -9895, -10087, -10278, -10469, -10659, -10849,
      -11038, -11227, -11416, -11604, -11792, -11980, -12166, -12353,
      -12539, -12724, -12909, -13094, -13278, -13462, -13645, -13827,
      -14009, -14191, -14372, -14552, -14732, -14911, -15090, -15268,
      -15446, -15623, -15799, -15975, -16150, -16325, -16499, -16672,
      -16845, -17017, -17189, -17360, -17530, -17699, -17868, -18036,
      -18204, -18371, -18537, -18702, -18867, -19031, -19194, -19357,
      -19519, -19680, -19840, -20000, -20159, -20317, -20474, -20631,
      -20787, -20942, -21096, -21249, -21402, -21554, -21705, -21855,
      -22004, -22153, -22301, -22448, -22594, -22739, -22883, -23027,
      -23169, -23311, -23452, -23592, -23731, -23869, -24006, -24143,
      -24278, -24413, -24546, -24679, -24811, -24942, -25072, -25201,
      -25329, -25456, -25582, -25707, -25831, -25954, -26077, -26198,
      -26318, -26437, -26556, -26673, -26789, -26905, -27019, -27132,
      -27244, -27355, -27466, -27575, -27683, -27790, -27896, -28001,
      -28105, -28208, -28309, -28410, -28510, -28608, -28706, -28802,
      -28897, -28992, -29085, -29177, -29268, -29358, -29446, -29534,
      -29621, -29706, -29790, -29873, -29955, -30036, -30116, -30195,
      -30272, -30349, -30424, -30498, -30571, -30643, -30713, -30783,
      -30851, -30918, -30984, -31049, -31113, -31175, -31236, -31297,
      -31356, -31413, -31470, -31525, -31580, -31633, -31684, -31735,
      -31785, -31833, -31880, -31926, -31970, -32014, -32056, -32097,
      -32137, -32176, -32213, -32249, -32284, -32318, -32350, -32382,
      -32412, -32441, -32468, -32495, -32520, -32544, -32567, -32588,
      -32609, -32628, -32646, -32662, -32678, -32692, -32705, -32717,
      -32727, -32736, -32744, -32751, -32757, -32761, -32764, -32766,
      -32767, -32766, -32764, -32761, -32757, -32751, -32744, -32736,
      -32727, -32717, -32705, -32692, -32678, -32662, -32646, -32628,
      -32609, -32588, -32567, -32544, -32520, -32495, -32468, -32441,
      -32412, -32382, -32350, -32318, -32284, -32249, -32213, -32176,
      -32137, -32097, -32056, -32014, -31970, -31926, -31880, -31833,
      -31785, -31735, -31684, -31633, -31580, -31525, -31470, -31413,
      -31356, -31297, -31236, -31175, -31113, -31049, -30984, -30918,
      -30851, -30783, -30713, -30643, -30571, -30498, -30424, -30349,
      -30272, -30195, -30116, -30036, -29955, -29873, -29790, -29706,
      -29621, -29534, -29446, -29358, -29268, -29177, -29085, -28992,
      -28897, -28802, -28706, -28608, -28510, -28410, -28309, -28208,
      -28105, -28001, -27896, -27790, -27683, -27575, -27466, -27355,
      -27244, -27132, -27019, -26905, -26789, -26673, -26556, -26437,
      -26318, -26198, -26077, -25954, -25831, -25707, -25582, -25456,
      -25329, -25201, -25072, -24942, -24811, -24679, -24546, -24413,
      -24278, -24143, -24006, -23869, -23731, -23592, -23452, -23311,
      -23169, -23027, -22883, -22739, -22594, -22448, -22301, -22153,
      -22004, -21855, -21705, -21554, -21402, -21249, -21096, -20942,
      -20787, -20631, -20474, -20317, -20159, -20000, -19840, -19680,
      -19519, -19357, -19194, -19031, -18867, -18702, -18537, -18371,
      -18204, -18036, -17868, -17699, -17530, -17360, -17189, -17017,
      -16845, -16672, -16499, -16325, -16150, -15975, -15799, -15623,
      -15446, -15268, -15090, -14911, -14732, -14552, -14372, -14191,
      -14009, -13827, -13645, -13462, -13278, -13094, -12909, -12724,
      -12539, -12353, -12166, -11980, -11792, -11604, -11416, -11227,
      -11038, -10849, -10659, -10469, -10278, -10087, -9895, -9703,
      -9511, -9319, -9126, -8932, -8739, -8545, -8351, -8156,
      -7961, -7766, -7571, -7375, -7179, -6982, -6786, -6589,
      -6392, -6195, -5997, -5799, -5601, -5403, -5205, -5006,
      -4807, -4608, -4409, -4210, -4011, -3811, -3611, -3411,
      -3211, -3011, -2811, -2610, -2410, -2209, -2009, -1808,
      -1607, -1406, -1206, -1005, -804, -603, -402, -201,};

// short hanning[1024] = {0, 0, 1, 2, 4, 7, 11, 15, 19, 25, 30, 37, 44, 52, 60, 69, 79, 89, 100, 111, 123, 136, 149, 163, 177, 192, 208, 224, 241, 259, 277, 296, 315, 335, 355, 377, 398, 421, 444, 467, 491, 516, 542, 568, 594, 621, 649, 677, 706, 736, 766, 797, 828, 860, 892, 925, 959, 993, 1028, 1064, 1099, 1136, 1173, 1211, 1249, 1288, 1327, 1367, 1408, 1449, 1491, 1533, 1576, 1619, 1663, 1707, 1752, 1798, 1844, 1891, 1938, 1986, 2034, 2083, 2132, 2182, 2232, 2283, 2335, 2387, 2440, 2493, 2546, 2600, 2655, 2710, 2766, 2822, 2879, 2936, 2994, 3052, 3111, 3170, 3230, 3290, 3351, 3412, 3474, 3536, 3599, 3662, 3725, 3790, 3854, 3919, 3985, 4051, 4117, 4184, 4252, 4320, 4388, 4457, 4526, 4596, 4666, 4736, 4807, 4879, 4950, 5023, 5095, 5169, 5242, 5316, 5391, 5465, 5541, 5616, 5692, 5769, 5846, 5923, 6001, 6079, 6157, 6236, 6315, 6395, 6475, 6555, 6636, 6717, 6798, 6880, 6962, 7045, 7127, 7211, 7294, 7378, 7462, 7547, 7632, 7717, 7803, 7888, 7975, 8061, 8148, 8235, 8323, 8410, 8498, 8587, 8675, 8764, 8854, 8943, 9033, 9123, 9213, 9304, 9395, 9486, 9577, 9669, 9761, 9853, 9945, 10038, 10131, 10224, 10318, 10411, 10505, 10599, 10693, 10788, 10882, 10977, 11072, 11168, 11263, 11359, 11455, 11551, 11647, 11743, 11840, 11937, 12034, 12131, 12228, 12326, 12423, 12521, 12619, 12717, 12815, 12913, 13012, 13110, 13209, 13308, 13406, 13505, 13605, 13704, 13803, 13903, 14002, 14102, 14201, 14301, 14401, 14501, 14601, 14701, 14801, 14901, 15001, 15102, 15202, 15303, 15403, 15503, 15604, 15704, 15805, 15906, 16006, 16107, 16207, 16308, 16409, 16509, 16610, 16711, 16811, 16912, 17012, 17113, 17213, 17314, 17414, 17515, 17615, 17715, 17816, 17916, 18016, 18116, 18216, 18316, 18416, 18516, 18616, 18715, 18815, 18914, 19014, 19113, 19212, 19311, 19410, 19509, 19608, 19706, 19805, 19903, 20001, 20099, 20197, 20295, 20393, 20490, 20588, 20685, 20782, 20879, 20975, 21072, 21168, 21264, 21360, 21456, 21552, 21647, 21742, 21837, 21932, 22027, 22121, 22215, 22309, 22403, 22496, 22589, 22682, 22775, 22868, 22960, 23052, 23144, 23235, 23327, 23418, 23508, 23599, 23689, 23779, 23869, 23958, 24047, 24136, 24224, 24313, 24401, 24488, 24575, 24662, 24749, 24836, 24922, 25007, 25093, 25178, 25263, 25347, 25431, 25515, 25598, 25681, 25764, 25846, 25928, 26010, 26091, 26172, 26252, 26332, 26412, 26492, 26571, 26649, 26727, 26805, 26883, 26960, 27036, 27113, 27189, 27264, 27339, 27414, 27488, 27562, 27635, 27708, 27780, 27853, 27924, 27995, 28066, 28136, 28206, 28276, 28345, 28413, 28481, 28549, 28616, 28683, 28749, 28815, 28880, 28945, 29010, 29073, 29137, 29200, 29262, 29324, 29386, 29447, 29507, 29567, 29627, 29686, 29744, 29802, 29860, 29917, 29973, 30029, 30084, 30139, 30194, 30248, 30301, 30354, 30406, 30458, 30509, 30560, 30610, 30660, 30709, 30757, 30805, 30853, 30900, 30946, 30992, 31037, 31082, 31126, 31170, 31213, 31255, 31297, 31339, 31380, 31420, 31459, 31499, 31537, 31575, 31613, 31649, 31686, 31721, 31756, 31791, 31825, 31858, 31891, 31923, 31955, 31986, 32016, 32046, 32075, 32104, 32132, 32159, 32186, 32212, 32238, 32263, 32288, 32312, 32335, 32358, 32380, 32401, 32422, 32442, 32462, 32481, 32499, 32517, 32534, 32551, 32567, 32582, 32597, 32611, 32625, 32638, 32650, 32662, 32673, 32683, 32693, 32703, 32711, 32719, 32727, 32733, 32740, 32745, 32750, 32754, 32758, 32761, 32764, 32766, 32767, 32767, 32767, 32767, 32766, 32764, 32761, 32758, 32754, 32750, 32745, 32740, 32733, 32727, 32719, 32711, 32703, 32693, 32683, 32673, 32662, 32650, 32638, 32625, 32611, 32597, 32582, 32567, 32551, 32534, 32517, 32499, 32481, 32462, 32442, 32422, 32401, 32380, 32358, 32335, 32312, 32288, 32263, 32238, 32212, 32186, 32159, 32132, 32104, 32075, 32046, 32016, 31986, 31955, 31923, 31891, 31858, 31825, 31791, 31756, 31721, 31686, 31649, 31613, 31575, 31537, 31499, 31459, 31420, 31380, 31339, 31297, 31255, 31213, 31170, 31126, 31082, 31037, 30992, 30946, 30900, 30853, 30805, 30757, 30709, 30660, 30610, 30560, 30509, 30458, 30406, 30354, 30301, 30248, 30194, 30139, 30084, 30029, 29973, 29917, 29860, 29802, 29744, 29686, 29627, 29567, 29507, 29447, 29386, 29324, 29262, 29200, 29137, 29073, 29010, 28945, 28880, 28815, 28749, 28683, 28616, 28549, 28481, 28413, 28345, 28276, 28206, 28136, 28066, 27995, 27924, 27853, 27780, 27708, 27635, 27562, 27488, 27414, 27339, 27264, 27189, 27113, 27036, 26960, 26883, 26805, 26727, 26649, 26571, 26492, 26412, 26332, 26252, 26172, 26091, 26010, 25928, 25846, 25764, 25681, 25598, 25515, 25431, 25347, 25263, 25178, 25093, 25007, 24922, 24836, 24749, 24662, 24576, 24488, 24401, 24313, 24224, 24136, 24047, 23958, 23869, 23779, 23689, 23599, 23508, 23418, 23327, 23235, 23144, 23052, 22960, 22868, 22775, 22682, 22589, 22496, 22403, 22309, 22215, 22121, 22027, 21932, 21837, 21742, 21647, 21552, 21456, 21360, 21264, 21168, 21072, 20975, 20879, 20782, 20685, 20588, 20490, 20393, 20295, 20197, 20099, 20001, 19903, 19805, 19706, 19608, 19509, 19410, 19311, 19212, 19113, 19014, 18914, 18815, 18715, 18616, 18516, 18416, 18316, 18216, 18116, 18016, 17916, 17816, 17715, 17615, 17515, 17414, 17314, 17213, 17113, 17012, 16912, 16811, 16711, 16610, 16509, 16409, 16308, 16207, 16107, 16006, 15906, 15805, 15704, 15604, 15503, 15403, 15303, 15202, 15102, 15001, 14901, 14801, 14701, 14601, 14501, 14401, 14301, 14201, 14102, 14002, 13903, 13803, 13704, 13605, 13505, 13406, 13308, 13209, 13110, 13012, 12913, 12815, 12717, 12619, 12521, 12423, 12326, 12228, 12131, 12034, 11937, 11840, 11743, 11647, 11551, 11455, 11359, 11263, 11168, 11072, 10977, 10882, 10788, 10693, 10599, 10505, 10411, 10318, 10224, 10131, 10038, 9945, 9853, 9761, 9669, 9577, 9486, 9395, 9304, 9213, 9123, 9033, 8943, 8854, 8764, 8675, 8587, 8498, 8410, 8323, 8235, 8148, 8061, 7975, 7888, 7803, 7717, 7632, 7547, 7462, 7378, 7294, 7211, 7127, 7045, 6962, 6880, 6798, 6717, 6636, 6555, 6475, 6395, 6315, 6236, 6157, 6079, 6001, 5923, 5846, 5769, 5692, 5616, 5541, 5465, 5391, 5316, 5242, 5169, 5095, 5023, 4950, 4879, 4807, 4736, 4666, 4596, 4526, 4457, 4388, 4320, 4252, 4184, 4117, 4051, 3985, 3919, 3854, 3790, 3725, 3662, 3599, 3536, 3474, 3412, 3351, 3290, 3230, 3170, 3111, 3052, 2994, 2936, 2879, 2822, 2766, 2710, 2655, 2600, 2546, 2493, 2440, 2387, 2335, 2283, 2232, 2182, 2132, 2083, 2034, 1986, 1938, 1891, 1844, 1798, 1752, 1707, 1663, 1619, 1576, 1533, 1491, 1449, 1408, 1367, 1327, 1288, 1249, 1211, 1173, 1136, 1099, 1064, 1028, 993, 959, 925, 892, 860, 828, 797, 766, 736, 706, 677, 649, 621, 594, 568, 542, 516, 491, 467, 444, 421, 398, 377, 355, 335, 315, 296, 277, 259, 241, 224, 208, 192, 177, 163, 149, 136, 123, 111, 100, 89, 79, 69, 60, 52, 44, 37, 30, 25, 19, 15, 11, 7, 4, 2, 1, 0, 0,};

// Added: Beichen Chen and Amy Chen 4 Dec 2017
double hanning[1024] = {0.0000000000,0.0000094310,0.0000377230,0.0000848750,0.0001508850,0.0002357510,0.0003394700,0.0004620380,0.0006034500,0.0007637000,
0.0009427830,0.0011406930,0.0013574200,0.0015929580,0.0018472980,0.0021204290,0.0024123420,0.0027230260,0.0030524680,0.0034006570,
0.0037675780,0.0041532200,0.0045575660,0.0049806020,0.0054223110,0.0058826780,0.0063616840,0.0068593110,0.0073755420,0.0079103550,
0.0084637320,0.0090356510,0.0096260910,0.0102350290,0.0108624430,0.0115083080,0.0121726010,0.0128552960,0.0135563680,0.0142757900,
0.0150135350,0.0157695750,0.0165438820,0.0173364260,0.0181471780,0.0189761070,0.0198231810,0.0206883690,0.0215716390,0.0224729560,
0.0233922870,0.0243295970,0.0252848510,0.0262580120,0.0272490450,0.0282579110,0.0292845720,0.0303289910,0.0313911270,0.0324709400,
0.0335683900,0.0346834350,0.0358160330,0.0369661420,0.0381337180,0.0393187170,0.0405210940,0.0417408040,0.0429778010,0.0442320390,
0.0455034690,0.0467920440,0.0480977160,0.0494204350,0.0507601510,0.0521168140,0.0534903720,0.0548807750,0.0562879680,0.0577119000,
0.0591525160,0.0606097620,0.0620835830,0.0635739240,0.0650807280,0.0666039390,0.0681434980,0.0696993490,0.0712714320,0.0728596880,
0.0744640570,0.0760844780,0.0777208910,0.0793732340,0.0810414430,0.0827254580,0.0844252130,0.0861406450,0.0878716890,0.0896182790,
0.0913803510,0.0931578370,0.0949506700,0.0967587830,0.0985821080,0.1004205750,0.1022741150,0.1041426590,0.1060261360,0.1079244750,
0.1098376050,0.1117654520,0.1137079450,0.1156650090,0.1176365720,0.1196225600,0.1216228960,0.1236375050,0.1256663120,0.1277092410,
0.1297662130,0.1318371510,0.1339219780,0.1360206140,0.1381329810,0.1402589980,0.1423985860,0.1445516640,0.1467181510,0.1488979640,
0.1510910220,0.1532972420,0.1555165400,0.1577488340,0.1599940380,0.1622520690,0.1645228400,0.1668062670,0.1691022620,0.1714107400,
0.1737316140,0.1760647950,0.1784101960,0.1807677290,0.1831373040,0.1855188320,0.1879122230,0.1903173870,0.1927342330,0.1951626710,
0.1976026070,0.2000539510,0.2025166100,0.2049904910,0.2074755010,0.2099715450,0.2124785300,0.2149963620,0.2175249450,0.2200641830,
0.2226139820,0.2251742440,0.2277448740,0.2303257740,0.2329168470,0.2355179950,0.2381291200,0.2407501240,0.2433809070,0.2460213710,
0.2486714160,0.2513309420,0.2539998480,0.2566780340,0.2593653990,0.2620618410,0.2647672600,0.2674815520,0.2702046150,0.2729363470,
0.2756766440,0.2784254040,0.2811825220,0.2839478940,0.2867214170,0.2895029850,0.2922924930,0.2950898380,0.2978949120,0.3007076100,
0.3035278250,0.3063554530,0.3091903850,0.3120325150,0.3148817360,0.3177379400,0.3206010200,0.3234708670,0.3263473740,0.3292304310,
0.3321199300,0.3350157620,0.3379178170,0.3408259870,0.3437401620,0.3466602310,0.3495860840,0.3525176120,0.3554547030,0.3583972470,
0.3613451320,0.3642982480,0.3672564830,0.3702197260,0.3731878640,0.3761607860,0.3791383790,0.3821205320,0.3851071320,0.3880980660,
0.3910932210,0.3940924840,0.3970957420,0.4001028830,0.4031137920,0.4061283550,0.4091464600,0.4121679920,0.4151928370,0.4182208820,
0.4212520110,0.4242861110,0.4273230670,0.4303627650,0.4334050900,0.4364499270,0.4394971610,0.4425466780,0.4455983620,0.4486520980,
0.4517077710,0.4547652660,0.4578244670,0.4608852590,0.4639475270,0.4670111550,0.4700760270,0.4731420280,0.4762090420,0.4792769540,
0.4823456470,0.4854150060,0.4884849160,0.4915552600,0.4946259220,0.4976967880,0.5007677400,0.5038386630,0.5069094410,0.5099799590,
0.5130501000,0.5161197490,0.5191887900,0.5222571070,0.5253245840,0.5283911060,0.5314565580,0.5345208220,0.5375837840,0.5406453290,
0.5437053400,0.5467637020,0.5498203010,0.5528750200,0.5559277440,0.5589783590,0.5620267480,0.5650727980,0.5681163930,0.5711574190,
0.5741957600,0.5772313030,0.5802639320,0.5832935330,0.5863199920,0.5893431950,0.5923630280,0.5953793760,0.5983921270,0.6014011660,
0.6044063790,0.6074076540,0.6104048770,0.6133979360,0.6163867170,0.6193711070,0.6223509940,0.6253262660,0.6282968100,0.6312625150,
0.6342232670,0.6371789570,0.6401294710,0.6430747000,0.6460145310,0.6489488540,0.6518775590,0.6548005340,0.6577176690,0.6606288550,
0.6635339820,0.6664329390,0.6693256180,0.6722119100,0.6750917050,0.6779648960,0.6808313720,0.6836910280,0.6865437540,0.6893894430,
0.6922279870,0.6950592810,0.6978832160,0.7006996860,0.7035085850,0.7063098070,0.7091032470,0.7118887980,0.7146663570,0.7174358180,
0.7201970760,0.7229500280,0.7256945690,0.7284305960,0.7311580070,0.7338766970,0.7365865650,0.7392875080,0.7419794240,0.7446622130,
0.7473357710,0.7500000000,0.7526547980,0.7553000650,0.7579357010,0.7605616070,0.7631776840,0.7657838330,0.7683799550,0.7709659540,
0.7735417310,0.7761071890,0.7786622320,0.7812067620,0.7837406850,0.7862639040,0.7887763240,0.7912778510,0.7937683890,0.7962478460,
0.7987161280,0.8011731410,0.8036187930,0.8060529910,0.8084756440,0.8108866610,0.8132859500,0.8156734210,0.8180489830,0.8204125480,
0.8227640260,0.8251033290,0.8274303670,0.8297450540,0.8320473010,0.8343370230,0.8366141330,0.8388785440,0.8411301720,0.8433689320,
0.8455947380,0.8478075080,0.8500071570,0.8521936030,0.8543667630,0.8565265560,0.8586728990,0.8608057120,0.8629249140,0.8650304250,
0.8671221670,0.8692000590,0.8712640240,0.8733139840,0.8753498610,0.8773715790,0.8793790610,0.8813722320,0.8833510170,0.8853153400,
0.8872651280,0.8892003070,0.8911208040,0.8930265470,0.8949174640,0.8967934840,0.8986545350,0.9005005470,0.9023314520,0.9041471790,
0.9059476610,0.9077328290,0.9095026160,0.9112569550,0.9129957810,0.9147190270,0.9164266280,0.9181185210,0.9197946410,0.9214549250,
0.9230993100,0.9247277350,0.9263401380,0.9279364580,0.9295166350,0.9310806090,0.9326283220,0.9341597140,0.9356747280,0.9371733080,
0.9386553960,0.9401209370,0.9415698750,0.9430021550,0.9444177240,0.9458165290,0.9471985150,0.9485636320,0.9499118280,0.9512430520,
0.9525572540,0.9538543830,0.9551343920,0.9563972320,0.9576428550,0.9588712140,0.9600822640,0.9612759580,0.9624522500,0.9636110980,
0.9647524570,0.9658762840,0.9669825370,0.9680711740,0.9691421530,0.9701954360,0.9712309810,0.9722487490,0.9732487030,0.9742308050,
0.9751950170,0.9761413030,0.9770696280,0.9779799560,0.9788722540,0.9797464870,0.9806026220,0.9814406280,0.9822604720,0.9830621240,
0.9838455530,0.9846107300,0.9853576260,0.9860862130,0.9867964630,0.9874883500,0.9881618470,0.9888169290,0.9894535720,0.9900717510,
0.9906714420,0.9912526250,0.9918152750,0.9923593730,0.9928848980,0.9933918290,0.9938801480,0.9943498370,0.9948008770,0.9952332510,
0.9956469440,0.9960419400,0.9964182230,0.9967757800,0.9971145970,0.9974346620,0.9977359610,0.9980184850,0.9982822210,0.9985271610,
0.9987532950,0.9989606150,0.9991491120,0.9993187800,0.9994696110,0.9996016020,0.9997147450,0.9998090380,0.9998844770,0.9999410590,
0.9999787810,0.9999976420,0.9999976420,0.9999787810,0.9999410590,0.9998844770,0.9998090380,0.9997147450,0.9996016020,0.9994696110,
0.9993187800,0.9991491120,0.9989606150,0.9987532950,0.9985271610,0.9982822210,0.9980184850,0.9977359610,0.9974346620,0.9971145970,
0.9967757800,0.9964182230,0.9960419400,0.9956469440,0.9952332510,0.9948008770,0.9943498370,0.9938801480,0.9933918290,0.9928848980,
0.9923593730,0.9918152750,0.9912526250,0.9906714420,0.9900717510,0.9894535720,0.9888169290,0.9881618470,0.9874883500,0.9867964630,
0.9860862130,0.9853576260,0.9846107300,0.9838455530,0.9830621240,0.9822604720,0.9814406280,0.9806026220,0.9797464870,0.9788722540,
0.9779799560,0.9770696280,0.9761413030,0.9751950170,0.9742308050,0.9732487030,0.9722487490,0.9712309810,0.9701954360,0.9691421530,
0.9680711740,0.9669825370,0.9658762840,0.9647524570,0.9636110980,0.9624522500,0.9612759580,0.9600822640,0.9588712140,0.9576428550,
0.9563972320,0.9551343920,0.9538543830,0.9525572540,0.9512430520,0.9499118280,0.9485636320,0.9471985150,0.9458165290,0.9444177240,
0.9430021550,0.9415698750,0.9401209370,0.9386553960,0.9371733080,0.9356747280,0.9341597140,0.9326283220,0.9310806090,0.9295166350,
0.9279364580,0.9263401380,0.9247277350,0.9230993100,0.9214549250,0.9197946410,0.9181185210,0.9164266280,0.9147190270,0.9129957810,
0.9112569550,0.9095026160,0.9077328290,0.9059476610,0.9041471790,0.9023314520,0.9005005470,0.8986545350,0.8967934840,0.8949174640,
0.8930265470,0.8911208040,0.8892003070,0.8872651280,0.8853153400,0.8833510170,0.8813722320,0.8793790610,0.8773715790,0.8753498610,
0.8733139840,0.8712640240,0.8692000590,0.8671221670,0.8650304250,0.8629249140,0.8608057120,0.8586728990,0.8565265560,0.8543667630,
0.8521936030,0.8500071570,0.8478075080,0.8455947380,0.8433689320,0.8411301720,0.8388785440,0.8366141330,0.8343370230,0.8320473010,
0.8297450540,0.8274303670,0.8251033290,0.8227640260,0.8204125480,0.8180489830,0.8156734210,0.8132859500,0.8108866610,0.8084756440,
0.8060529910,0.8036187930,0.8011731410,0.7987161280,0.7962478460,0.7937683890,0.7912778510,0.7887763240,0.7862639040,0.7837406850,
0.7812067620,0.7786622320,0.7761071890,0.7735417310,0.7709659540,0.7683799550,0.7657838330,0.7631776840,0.7605616070,0.7579357010,
0.7553000650,0.7526547980,0.7500000000,0.7473357710,0.7446622130,0.7419794240,0.7392875080,0.7365865650,0.7338766970,0.7311580070,
0.7284305960,0.7256945690,0.7229500280,0.7201970760,0.7174358180,0.7146663570,0.7118887980,0.7091032470,0.7063098070,0.7035085850,
0.7006996860,0.6978832160,0.6950592810,0.6922279870,0.6893894430,0.6865437540,0.6836910280,0.6808313720,0.6779648960,0.6750917050,
0.6722119100,0.6693256180,0.6664329390,0.6635339820,0.6606288550,0.6577176690,0.6548005340,0.6518775590,0.6489488540,0.6460145310,
0.6430747000,0.6401294710,0.6371789570,0.6342232670,0.6312625150,0.6282968100,0.6253262660,0.6223509940,0.6193711070,0.6163867170,
0.6133979360,0.6104048770,0.6074076540,0.6044063790,0.6014011660,0.5983921270,0.5953793760,0.5923630280,0.5893431950,0.5863199920,
0.5832935330,0.5802639320,0.5772313030,0.5741957600,0.5711574190,0.5681163930,0.5650727980,0.5620267480,0.5589783590,0.5559277440,
0.5528750200,0.5498203010,0.5467637020,0.5437053400,0.5406453290,0.5375837840,0.5345208220,0.5314565580,0.5283911060,0.5253245840,
0.5222571070,0.5191887900,0.5161197490,0.5130501000,0.5099799590,0.5069094410,0.5038386630,0.5007677400,0.4976967880,0.4946259220,
0.4915552600,0.4884849160,0.4854150060,0.4823456470,0.4792769540,0.4762090420,0.4731420280,0.4700760270,0.4670111550,0.4639475270,
0.4608852590,0.4578244670,0.4547652660,0.4517077710,0.4486520980,0.4455983620,0.4425466780,0.4394971610,0.4364499270,0.4334050900,
0.4303627650,0.4273230670,0.4242861110,0.4212520110,0.4182208820,0.4151928370,0.4121679920,0.4091464600,0.4061283550,0.4031137920,
0.4001028830,0.3970957420,0.3940924840,0.3910932210,0.3880980660,0.3851071320,0.3821205320,0.3791383790,0.3761607860,0.3731878640,
0.3702197260,0.3672564830,0.3642982480,0.3613451320,0.3583972470,0.3554547030,0.3525176120,0.3495860840,0.3466602310,0.3437401620,
0.3408259870,0.3379178170,0.3350157620,0.3321199300,0.3292304310,0.3263473740,0.3234708670,0.3206010200,0.3177379400,0.3148817360,
0.3120325150,0.3091903850,0.3063554530,0.3035278250,0.3007076100,0.2978949120,0.2950898380,0.2922924930,0.2895029850,0.2867214170,
0.2839478940,0.2811825220,0.2784254040,0.2756766440,0.2729363470,0.2702046150,0.2674815520,0.2647672600,0.2620618410,0.2593653990,
0.2566780340,0.2539998480,0.2513309420,0.2486714160,0.2460213710,0.2433809070,0.2407501240,0.2381291200,0.2355179950,0.2329168470,
0.2303257740,0.2277448740,0.2251742440,0.2226139820,0.2200641830,0.2175249450,0.2149963620,0.2124785300,0.2099715450,0.2074755010,
0.2049904910,0.2025166100,0.2000539510,0.1976026070,0.1951626710,0.1927342330,0.1903173870,0.1879122230,0.1855188320,0.1831373040,
0.1807677290,0.1784101960,0.1760647950,0.1737316140,0.1714107400,0.1691022620,0.1668062670,0.1645228400,0.1622520690,0.1599940380,
0.1577488340,0.1555165400,0.1532972420,0.1510910220,0.1488979640,0.1467181510,0.1445516640,0.1423985860,0.1402589980,0.1381329810,
0.1360206140,0.1339219780,0.1318371510,0.1297662130,0.1277092410,0.1256663120,0.1236375050,0.1216228960,0.1196225600,0.1176365720,
0.1156650090,0.1137079450,0.1117654520,0.1098376050,0.1079244750,0.1060261360,0.1041426590,0.1022741150,0.1004205750,0.0985821080,
0.0967587830,0.0949506700,0.0931578370,0.0913803510,0.0896182790,0.0878716890,0.0861406450,0.0844252130,0.0827254580,0.0810414430,
0.0793732340,0.0777208910,0.0760844780,0.0744640570,0.0728596880,0.0712714320,0.0696993490,0.0681434980,0.0666039390,0.0650807280,
0.0635739240,0.0620835830,0.0606097620,0.0591525160,0.0577119000,0.0562879680,0.0548807750,0.0534903720,0.0521168140,0.0507601510,
0.0494204350,0.0480977160,0.0467920440,0.0455034690,0.0442320390,0.0429778010,0.0417408040,0.0405210940,0.0393187170,0.0381337180,
0.0369661420,0.0358160330,0.0346834350,0.0335683900,0.0324709400,0.0313911270,0.0303289910,0.0292845720,0.0282579110,0.0272490450,
0.0262580120,0.0252848510,0.0243295970,0.0233922870,0.0224729560,0.0215716390,0.0206883690,0.0198231810,0.0189761070,0.0181471780,
0.0173364260,0.0165438820,0.0157695750,0.0150135350,0.0142757900,0.0135563680,0.0128552960,0.0121726010,0.0115083080,0.0108624430,
0.0102350290,0.0096260910,0.0090356510,0.0084637320,0.0079103550,0.0073755420,0.0068593110,0.0063616840,0.0058826780,0.0054223110,
0.0049806020,0.0045575660,0.0041532200,0.0037675780,0.0034006570,0.0030524680,0.0027230260,0.0024123420,0.0021204290,0.0018472980,
0.0015929580,0.0013574200,0.0011406930,0.0009427830,0.0007637000,0.0006034500,0.0004620380,0.0003394700,0.0002357510,0.0001508850,
0.0000848750,0.0000377230,0.0000094310,0.0000000000,};

/*
   fix_mpy() - fixed-point multiplication
 */
short gst_spectrum_fix_mpy (short a, short b)
{
  FIX_MPY (a, a, b);
  return a;
}

/*
   fix_fft() - perform fast Fourier transform.

   if n>0 FFT is done, if n<0 inverse FFT is done
   fr[n],fi[n] are real,imaginary arrays, INPUT AND RESULT.
   size of data = 2**m
   set inverse to 0=dft, 1=idft
 */
int gst_spectrum_fix_fft (short fr[], short fi[], int m, int inverse)
{
  int mr, nn, i, j, l, k, istep, n, scale, shift;
  short qr, qi, tr, ti, wr, wi;

  n = 1 << m;

  if (n > N_WAVE)
    return -1;

  mr = 0;
  nn = n - 1;
  scale = 0;

  /* decimation in time - re-order data */
  for (m = 1; m <= nn; ++m) {
    l = n;
    do {
      l >>= 1;
    }
    while (mr + l > nn);
    mr = (mr & (l - 1)) + l;

    if (mr <= m)
      continue;
    tr = fr[m];
    fr[m] = fr[mr];
    fr[mr] = tr;
    ti = fi[m];
    fi[m] = fi[mr];
    fi[mr] = ti;
  }

  l = 1;
  k = LOG2_N_WAVE - 1;
  while (l < n) {
    if (inverse) {
      /* variable scaling, depending upon data */
      shift = 0;
      for (i = 0; i < n; ++i) {
        j = fr[i];
        if (j < 0)
          j = -j;
        m = fi[i];
        if (m < 0)
          m = -m;
        if (j > 16383 || m > 16383) {
          shift = 1;
          break;
        }
      }
      if (shift)
        ++scale;
    } else {
      /* fixed scaling, for proper normalization -
         there will be log2(n) passes, so this
         results in an overall factor of 1/n,
         distributed to maximize arithmetic accuracy. */
      shift = 1;
    }
    /* it may not be obvious, but the shift will be performed
       on each data point exactly once, during this pass. */
    istep = l << 1;
    for (m = 0; m < l; ++m) {
      j = m << k;
      /* 0 <= j < N_WAVE/2 */
      wr = gst_spectrum_Sinewave[j + N_WAVE / 4];
      wi = -gst_spectrum_Sinewave[j];
      if (inverse)
        wi = -wi;
      if (shift) {
        wr >>= 1;
        wi >>= 1;
      }
      for (i = m; i < n; i += istep) {
        j = i + l;
        tr = gst_spectrum_fix_mpy (wr, fr[j]) -
            gst_spectrum_fix_mpy (wi, fi[j]);
        ti = gst_spectrum_fix_mpy (wr, fi[j]) +
            gst_spectrum_fix_mpy (wi, fr[j]);
        qr = fr[i];
        qi = fi[i];
        if (shift) {
          qr >>= 1;
          qi >>= 1;
        }
        fr[j] = qr - tr;
        fi[j] = qi - ti;
        fr[i] = qr + tr;
        fi[i] = qi + ti;
      }
    }
    --k;
    l = istep;
  }

  return scale;
}

#endif
